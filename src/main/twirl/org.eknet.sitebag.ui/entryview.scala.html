@(entry: PageEntry, settings: WebSettings)
<div class="page-header">
  <h1>@entry.title</h1>
  <div class="small">
    <span class="glyphicon glyphicon-calendar"></span> @entry.created&nbsp;
    <span class="glyphicon glyphicon-link"></span> <a href="@entry.url.toString" title="@entry.url.toString">@entry.url.authority.host.address</a>&nbsp;
    <span class="glyphicon glyphicon-floppy-open"></span> <a href="@(settings.base.pathPrefix)ui/entry/@entry.id/cache" target="_blank" title="View original page from cache">Cache View</a>&nbsp;
    <span class="glyphicon glyphicon-tags"> </span> <span class="sb-tagstring"></span>
  </div>
</div>

<div data-spy="affix" class="sb-entry-actions-view-container">
  <div class="sb-entry-actions-inner"  data-id="@entry.id">
    <span class="sb-entry-actions"></span>&mdash;
    <a href="#" title="Back to top" onclick="window.scrollTo(0, 0); return false;"><span class="glyphicon glyphicon-chevron-up"></span></a>
  </div>
</div>
<div class="col-md-8 col-md-offset-2 sb-entry-content">

</div>

@org.eknet.sitebag.ui.html.entryactions()

@if(settings.enableHighlightJs) {
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/styles/@(settings.highlightJsTheme).min.css"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js"></script>
}

<script type="application/javascript">
  function rewriteUrls() {
    $('.sb-entry-content').find('img[src]').each(function(i, el) {
      var url = el.src;
      if (!settings.isBinPath(url)) {
        $(el).attr("src", settings.binPath(url));
        $(el).addClass("img-responsive");
      }
    });
  }
  function codeHighlight() {
    if (settings.enableHighlightJs) {
      $('pre code').each(function(i, e) {hljs.highlightBlock(e)});
    }
  }

  var sitebagEntryId = "@entry.id";
  function sb_renderActions(entry) {
    var actions = render('sbtpl-entry-actions', {
      favourite: $.inArray('favourite', entry.value.tags) >= 0,
      archived: entry.value.archived
    });
    $('.sb-entry-actions').html(actions);
    bindEntryActions(function(action, id) {
      if (action === "delete") {
        location.href = settings.uiPath();
      } else {
        getEntry(true, function(entry) {
          sb_renderActions(entry);
          sb_renderTags(entry);
        })
      }
    });
  }
  function sb_renderTags(entry) {
    var tagstr = function() {
      return entry.value.tags.reduce(function(a, b) {
        return a +", "+ b;
      });
    };
    $('.sb-tagstring').html(entry.value.tags.length == 0 ? "" : tagstr());
  }
  function sb_renderContent(entry) {
    $('.sb-entry-content').html(entry.value.content);
  }
  function getEntry(meta, callback) {
    ajaxGet(settings.apiPath("/entry/"+sitebagEntryId + (meta ? "?meta" : "")), function(data) {
      if (data.success) {
        callback(data);
      } else {
        feedback(data);
      }
    });
  }

  function bindAddLinks() {
    $('.sb-add-entry-link').click(function(ev) {
      var self = $(this);
      var url = self.attr('data-id');
      if (url) {
        spin(self.parent());
        ajaxPost(settings.apiPath("/entry"), { url: url }, function(data) {
          stopSpin(self.parent());
          feedback(data);
          if (data.success) {
            self.remove();
            $('a[href="'+url+'"]').attr("href", settings.uiPath("/entry/"+data.value))
          }
        });
      }
      ev.preventDefault();
      return false;
    });
  }
  spin($('.sb-entry-content'));
  getEntry(false, function(entry) {
    sb_renderActions(entry);
    sb_renderTags(entry);
    sb_renderContent(entry);
    rewriteUrls();
    codeHighlight();
    stopSpin($('.sb-entry-content'));
    bindAddLinks();
  });
</script>